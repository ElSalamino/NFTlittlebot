
lotteria = {"Attiva":False,"Iscritti":list(),"Altro":{},"Iscrizioni":False}

@app.on_message(filters.command("rotteria") & filters.user(autorizzati) & ~filters.user(bannati))
def jlotteria(client, message): 
    global lotteria
    if lotteria["Attiva"] == False:
        lotteria["Iscrizioni"] = True
        lotteria["Attiva"] = True
        username = message.from_user.username
        app.send_message("NFTupdates",f"A quanto pare la rotteria è aperta nel parchetto dei tossici!\nAccorrete numerosi a lamentarvi dei vincitori!\n\nhttps://t.me/joinchat/3H0yl932lSwyNTY0")
        message.reply("ROOOOOOOOOOTTERIA!\nIscriviti con /iscrivi per orrbili premi!")
    else:
        scritti = lotteria["Iscritti"]
        message.reply(f"La rotteria è aperta con ben {len(scritti)} mele iscritte!")

@app.on_message(filters.command("estrazione") & filters.user(autorizzati) & ~filters.user(bannati))
def estrazione(client, message): 
    global lotteria
    username = message.from_user.username
    lotteria["Iscrizioni"] = False
    vincitore = random.choice(lotteria["Iscritti"])
    cosa = random.choice(tutto)
    
    if len(message.command) == 1:
        pass
    else:
        cosa = cosa.replace("0",message.command[1])
    
    if cosa in player[vincitore]["zaino"]:
        player[vincitore]["zaino"][cosa] += 1
    else:
        player[vincitore]["zaino"][cosa] = 1
        
    lotteria["Iscritti"].remove(vincitore)
    message.reply(f"Dal magico coso delle rotterie viene estratto {vincitore}!\nChe solo per oggi si porta a casa {cosa}!\n\nSiete liberi di insultarlo!")
    app.send_message("NFTupdates",f"Dal magico coso delle rotterie viene estratto {vincitore}!\nChe solo per oggi si porta a casa {cosa}!\n\nSiete liberi di insultarlo!")
    

@app.on_message(filters.command("finale") & filters.user(autorizzati) & ~filters.user(bannati))
def fine(client, message): 
    global lotteria
    username = message.from_user.username
    lotteria["Iscrizioni"] = False
    vincitore = random.choice(lotteria["Iscritti"])
    cosa = random.choice(tutto)
    
    if len(message.command) == 1:
        pass
    else:
        cosa = cosa.replace("0",message.command[1])
    
    if cosa in player[vincitore]["zaino"]:
        player[vincitore]["zaino"][cosa] += 1
    else:
        player[vincitore]["zaino"][cosa] = 1
        
    lotteria["Iscritti"].remove(vincitore)
    lotteria["Attiva"] = False
    lotteria["Iscritti"] = list()
    message.reply(f"E come tutte le cose belle anche questa rotteria deve finire...\nMa non prima che {vincitore} vinca!\nChe solo per oggi si porta a casa {cosa}!\n\nSiete liberi di insultarlo!")
    app.send_message("NFTupdates",f"E come tutte le cose belle anche questa rotteria deve finire...\nMa non prima che {vincitore} vinca!\nChe solo per oggi si porta a casa {cosa}!\n\nSiete liberi di insultarlo!")     

@app.on_message(filters.command(["iscrivi","iscrivi@NFTlittlebot"]) & ~filters.user(bannati))
def fine(client, message): 
    global lotteria
    username = message.from_user.username
    if username in player:
        
        if lotteria["Attiva"] == True:
            if lotteria["Iscrizioni"] == True:
                if username not in lotteria["Iscritti"]:
                    if message.chat.id == -1001476172565:
                        
                        lotteria["Iscritti"].append(username)
                        message.reply("Iscritto!")
                else:
                    message.reply("Sei già dentro!")
            else:
                message.reply("Non puoi ora!")
        else:
            pass
